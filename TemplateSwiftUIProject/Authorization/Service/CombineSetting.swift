//
//  CombineSetting.swift
//  TemplateSwiftUIProject
//
//  Created by Evgenyi on 19.06.25.
//

// MARK: - Combine -


// subscriber and .store


// –ü–ª–æ—Ö–æ: –ø–æ–¥–ø–∏—Å–∫–∞ –∂–∏–≤–µ—Ç –≤–µ—á–Ω–æ
//somePublisher
//    .sink { [weak self] _ in ... }
    // –ù–µ—Ç .store(in: &cancellables)


// –ü–ª–æ—Ö–æ: –ø–æ–¥–ø–∏—Å–∫–∞ —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É
//somePublisher.sink { ... } // –ù–µ—Ç .store

// MARK: - life cycle Publisher

//–í Combine –ª—é–±–∞—è —Ü–µ–ø–æ—á–∫–∞ –ø–∞–±–ª–∏—à–µ—Ä–æ–≤ –∂–∏–≤—ë—Ç –ø–æ –æ–¥–Ω–æ–º—É –ø—Ä–æ—Å—Ç–æ–º—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É:
///–ó–∞ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø–æ–¥–ø–∏—Å–∫–∏ Publisher –º–æ–∂–µ—Ç –≤—ã–¥–∞—Ç—å 0‚Ä¶N —Å–æ–±—ã—Ç–∏–π ¬´–∑–Ω–∞—á–µ–Ω–∏–µ¬ª ‚Ä¢ –ê –ø–æ—Ç–æ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–¥–∏–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π —ç–≤–µ–Ω—Ç: .finished –∏–ª–∏ .failure(Error) ‚Ä¢ –ü–æ—Å–ª–µ —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç–≤–µ–Ω—Ç–∞ ‚Äî –±–æ–ª—å—à–µ –Ω–∏–∫–∞–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π, –ø–æ–¥–ø–∏—Å–∫–∞ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è



//  1. example: –û—Ç Publisher –≤ sink –º–∏–Ω—É—è –≤—Å–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã:




///—Ç–∞–∫ –∫–∞–∫ —É –Ω–∞—Å –≤ Publisher<Output, AuthError> AuthError - –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π! (–µ—Å–ª–∏ Never —Ç–æ —Å –æ—à–∏–±–∫–æ–π –Ω–µ –º–æ–∂–µ—Ç)
/// –∏ –µ—Å–ª–∏ –º—ã –Ω–∞ –ª—é–±–æ–º —à–∞–≥–µ –≤ currentUserPublisher() –∏–ª–∏ –≤ .flatMap –ø—É—à–∏–º  .failure(AuthError) —á–µ—Ä–µ–∑ Fail –∏–ª–∏ Future/promise(.failure). - –¢–û–ì–î–ê  –ü–û–¢–û–ö –°–†–ê–ó–£ –ñ–ï –ü–ï–†–ï–•–û–î–ò–¢ –ù–ê .SINK –ú–ò–ù–£–Ø .flatMap

///Fail(error: ‚Ä¶) –≠—Ç–æ –ø–∞–±–ª–∏—à–µ—Ä-¬´—Ö–µ–ª–ø–µ—Ä¬ª, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∂–µ .subscribe —Å—Ä–∞–∑—É —à–ª—ë—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫—É .failure(‚Ä¶) –∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É. downstream-–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã (flatMap, handleEvents, map) –Ω–∏–∫–æ–≥–¥–∞ –¥–∞–∂–µ –Ω–µ –±—É–¥—É—Ç –≤—ã–∑–≤–∞–Ω—ã, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏–ª–∏ ¬´–æ—à–∏–±–∫—É ‚Üí –∫–æ–Ω–µ—Ü¬ª –∏ –æ—Ç–ø–∏—Å–∞–ª–∏—Å—å.

///–ö–ª—é—á–µ–≤–∞—è –º—ã—Å–ª—å: –≤ Combine –æ–¥–Ω–æ –ø–æ—è–≤–ª–µ–Ω–∏–µ .failure –∏–ª–∏ .finished –æ–∑–Ω–∞—á–∞–µ—Ç –∫–æ–Ω–µ—Ü —Ü–µ–ø–æ—á–∫–∏ –∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—É—é –æ—Ç–ø–∏—Å–∫—É –æ—Ç –≤—Å–µ—Ö upstream-–æ–ø–µ—Ä–∞—Ü–∏–π.

//func signUp(
//  email: String,
//  password: String,
//  name: String
//) -> AnyPublisher<Bool, AuthError> {
//    // 1) –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ user –∏–ª–∏ –∫–∏–¥–∞–µ–º .notAuthorized
//    currentUserPublisher()
//    // 2) –ï—Å–ª–∏ –∞–Ω–æ–Ω–∏–º ‚Äì –ª–∏–Ω–∫—É–µ–º email/password, –∏–Ω–∞—á–µ —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π
//    .flatMap { user in
//        user.isAnonymous
//          ? self.linkPublisher(email: email, password: password)
//          : self.createUserPublisher(email: email, password: password)
//    }
//    // 3) –°–æ–∑–¥–∞—ë–º –ø—Ä–æ—Ñ–∏–ª—å (displayName + –≤–µ—Ä–∏—Ñ–∏–∫–µ–π—à–Ω)
//    .flatMap { _ in
//        self.createProfilePublisher(name: name)
//    }
//    // 4) –ü–æ —É—Å–ø–µ—à–Ω–æ–º—É —Å–æ–∑–¥–∞–Ω–∏—é —à–ª—ë–º –ø–∏—Å—å–º–æ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º true
//    .handleEvents(receiveOutput: { _ in
//        self.sendVerificationEmail()
//    })
//    .map { _ in true }
//    // 5) –ë—Ä–æ—Å–∞–µ–º –≤—Å—ë –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ–æ–Ω–æ–≤—É—é –æ—á–µ—Ä–µ–¥—å, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–¥–∞–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—ã–π
//    .subscribe(on: DispatchQueue.global(qos: .userInitiated))
//    .receive(on: DispatchQueue.main)
//    .eraseToAnyPublisher()
//}


//  2. example: –û—Ç Publisher –≤ flatMap ( –ø–æ—á–µ–º—É –ø—Ä–∏ authenticationPublisher.send(.failure(authenticationError)) –º—ã –ø–æ–ø–∞–¥–∞–µ–º –Ω–µ –≤ .sink –∞ —Å–Ω–∞—á–∞–ª–æ –≤ flatMap?)

///–ö–æ–≥–¥–∞ –≤—ã –≤—ã–∑—ã–≤–∞–µ—Ç–µ authenticationService.authenticate(), –æ–Ω —à–ª—ë—Ç –≤–∞–º –Ω–µ –æ—à–∏–±–∫—É Combine (–ø–æ—Å–∫–æ–ª—å–∫—É Failure == Never), –∞ –∑–Ω–∞—á–µ–Ω–∏–µ‚ÄìResult.failure(authenticationError). –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω –Ω–µ ¬´–ø–∞–¥–∞–µ—Ç¬ª –≤ sink(receiveCompletion:), –∞ –ø–µ—Ä–µ–¥–∞—ë—Ç Result.failure –¥–∞–ª—å—à–µ: –ø–µ—Ä–≤—ã–º –µ–≥–æ –ª–æ–≤–∏—Ç –≤–∞—à flatMap, –≤ –±–ª–æ–∫–µ case .failure –≤—ã —Å–æ–∑–¥–∞—ë—Ç–µ Just(.failure(error)), –∏ —É–∂–µ —ç—Ç–æ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–±–µ–≥–∞–µ—Ç –¥–æ sink(receiveValue:), –≥–¥–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç case .failure. –ò–º–µ–Ω–Ω–æ flatMap –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ç–æ, —á—Ç–æ–±—ã –≤–∑—è—Ç—å –∫–∞–∂–¥–æ–µ –≤—Ö–æ–¥—è—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –ø–æ–¥–º–µ–Ω–∏—Ç—å –µ–≥–æ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–π Publisher (–±—É–¥—å —Ç–æ Just, —Å–µ—Ç–µ–≤–æ–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ) –∏ ¬´—Ä–∞—Å–ø–ª—é—â–∏—Ç—å¬ª –≤—Å–µ –≤—ã—Ö–æ–¥—ã —ç—Ç–∏—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–∞–±–ª–∏—à–µ—Ä–æ–≤ –≤ –æ–¥–∏–Ω –µ–¥–∏–Ω—ã–π –ø–æ—Ç–æ–∫, –ø–æ–∑–≤–æ–ª—è—è –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º—ã—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤.



///Service
//private func createAnonymousUser() {
//    Auth.auth().signInAnonymously { [weak self] authResult, error in
//        guard let self = self else { return }
//        guard let user = authResult?.user else {
//            let authenticationError = error ?? NSError(domain: "Anonymous Auth", code: -1, userInfo: [NSLocalizedDescriptionKey: "Unknown error occurred during anonymous authentication"])
//            self.authenticationPublisher.send(.failure(authenticationError))
//            return
//        }
//        // –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º, —Ç–∞–∫ –∫–∞–∫ addStateDidChangeListener –æ—Ç—Ä–∞–±–æ—Ç–∞–µ—Ç —Å–Ω–æ–≤–∞ –∏ –≤—ã–∑–æ–≤–µ—Ç authPublisher.send(.success(user.uid))
//    }
//}

/// ViewModel
//private func bind() {
//    viewState = .loading
//    authenticationService.authenticate()
//        .flatMap { [weak self] result -> AnyPublisher<Result<[BookCloud], Error>, Never> in
//            guard let self = self else {
//                return Just(.success([])).eraseToAnyPublisher()
//            }
//            switch result {
//            case .success(let userId):
//                
//                return firestorColletionObserverService.observeCollection(at: "users/\(userId)/data")
//            case .failure(let error):
//                stateError = .globalError
//                return Just(.failure(error)).eraseToAnyPublisher()
//            }
//        }
//        .receive(on: DispatchQueue.main)
//        .sink { [weak self] result in
//            switch result {
//            case .success(let data):
//                self?.viewState = .content(data)
//            case .failure(let error):
//                self?.handleStateError(error)
//            }
//        }
//        .store(in: &cancellables)
//}




// MARK: - .sink(receiveCompletion:receiveValue:)

///–ë–ª–æ–∫ receiveValue (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ success in) —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ –ø–∞–π–ø–ª–∞–π–Ω —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –±–µ–∑ –æ—à–∏–±–∫–∏ –∏ –≤–µ—Ä–Ω—ë—Ç –∑–Ω–∞—á–µ–Ω–∏–µ. –í –≤–∞—à–µ–º —Å–ª—É—á–∞–µ ‚Äî –∫–æ–≥–¥–∞ AuthorizationManager.signUp(...) –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤—Å—é —Ü–µ–ø–æ—á–∫—É (currentUserPublisher ‚Üí link/createUser ‚Üí createProfile) –±–µ–∑ –æ—à–∏–±–æ–∫ –∏ .map { _ in true } —ç–º–∏—Ç–∏—Ç true.
///–ë–ª–æ–∫ receiveCompletion (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ completion in) —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–¥–∏–Ω —Ä–∞–∑ ‚Äî –∫–æ–≥–¥–∞ –ø–∞–π–ø–ª–∞–π–Ω –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è:
///.finished ‚Äî —Ü–µ–ø–æ—á–∫–∞ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–∞ –±–µ–∑ –æ—à–∏–±–æ–∫. ‚Üí –≠—Ç–æ —Ç–∞–∫–∂–µ —Å–ª—É—á–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ receiveValue, –Ω–æ –≤ —Ç–≤–æ—ë–º –∫–æ–¥–µ case .finished –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è.
///.failure(let error) ‚Äî —Ü–µ–ø–æ—á–∫–∞ –≥–¥–µ-—Ç–æ —É–ø–∞–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Fail(error) –∏–ª–∏ Future.promise(.failure(...))). ‚Üí –¢–æ–≥–¥–∞ —Ç—ã –ø–æ–ø–∞–¥–∞–µ—à—å –≤ case .failure(let err) –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—à—å error = err.
///–í—Å—ë –ø—Ä–æ—à–ª–æ –±–µ–∑ –æ—à–∏–±–æ–∫    - üëâ –°—Ä–∞–±–æ—Ç–∞–µ—Ç receiveValue(success), –∑–∞—Ç–µ–º ‚Äî completion: .finished (–∫–æ—Ç–æ—Ä—ã–π —Ç—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—à—å)
///–ì–¥–µ-—Ç–æ –≤ –ø–∞–π–ø–ª–∞–π–Ω–µ –≤—ã–∑–≤–∞–Ω .failure (–Ω–∞–ø—Ä–∏–º–µ—Ä, Fail(.notAuthorized))    - üëâ –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è receiveCompletion(.failure(error)) ‚Äî receiveValue –¥–∞–∂–µ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
///receiveValue —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ + receiveCompletion —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ (—Å–Ω–∞—á–∞–ª–∞ .failure, –ª–∏–±–æ –ø–æ—Å–ª–µ value ‚Äî .finished), –Ω–æ —Ç—ã –ª–æ–≤–∏—à—å —Ç–æ–ª—å–∫–æ .failure


// MARK: - Publisher<Output, Failure>

///–í Combine –∫–∞–∂–¥—ã–π –ø–∞–±–ª–∏—à–µ—Ä –æ–±—ä—è–≤–ª—è–µ—Ç –¥–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞-- —á—Ç–æ –æ–Ω –ø—É–±¬≠–ª–∏¬≠–∫—É–µ—Ç (Output) –∏ —á—Ç–æ –æ–Ω –º–æ–∂–µ—Ç –∑–∞¬≠–ø—É—à–∏—Ç—å –∫–∞–∫ –æ—à–∏–±–∫—É (Failure).
///AnyPublisher ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ ¬´—É–ø–∞–∫–æ–≤–∫–∞ –≤ –∫–æ—Å—Ç—é–º-–Ω–µ–≤–∏–¥–∏–º–∫—É¬ª, –∫–æ—Ç–æ—Ä–∞—è —Å–∫—Ä—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø –ø–∞–±–ª–∏—à–µ—Ä–∞, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ —Ç–∞—â–∏—Ç –∑–∞ —Å–æ–±–æ–π –µ–≥–æ Output –∏ Failure:
///AnyPublisher<Result<String, Error>, Never>
///Output = Result<String, Error> ‚Äî —Ç–æ, —á—Ç–æ –ø—Ä–∏–¥—ë—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫—É –∫–∞–∫ ¬´–∑–Ω–∞—á–µ–Ω–∏–µ¬ª. –í –≤–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ –∏–ª–∏ ‚Äì .success(userId: String) ‚Äì .failure(error: Error) ‚Äî —Å–∞–º–∏ –æ—à–∏–±–∫–∏ Firebase –≤—ã –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç–µ –≤–Ω—É—Ç—Ä—å Result, —á—Ç–æ–±—ã –ø–æ—Ç–æ–∫ Combine –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ ¬´–≤–∞–ª–∏–ª—Å—è¬ª.
///Failure = Never ‚Äî —ç—Ç–æ —Ç–∏–ø –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—É—é –ø–∞–±–ª–∏—à–µ—Ä –º–æ–∂–µ—Ç –≤—ã–¥–∞—Ç—å –∫–∞–∫ —á–∞—Å—Ç—å —Å–∞–º–æ–≥–æ Combine. ‚Äî Never –æ–∑–Ω–∞—á–∞–µ—Ç ¬´–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–ª—É—á–∏—Ç—Å—è¬ª. –í—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç–µ, —á—Ç–æ –≤–∞—à –ø–æ—Ç–æ–∫ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å .failure(...), –∞ —Ç–æ–ª—å–∫–æ –≤ –ª—É—á—à–µ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ .finished –∏–ª–∏ —Å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π —Å–µ—Ä–∏–µ–π –∑–Ω–∞—á–µ–Ω–∏–π.
///–ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ?
///–ü—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ .sink –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: publisher.sink { result in // —Å—é–¥–∞ –ø–æ–ø–∞–¥—É—Ç —Ç–æ–ª—å–∫–æ –≤–∞—à–∏ Result<‚Ä¶, Error> }
///–ê –±–ª–æ–∫ receiveCompletion –Ω–µ –Ω—É–∂–µ–Ω, –ø–æ—Ç–æ–º—É —á—Ç–æ .failure –≤ —Ç–µ—Ä–º–∏–Ω–∞—Ö Combine –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–ª—É—á–∏—Ç—Å—è, –∞ –ø—Ä–æ .finished –≤—ã –æ–±—ã—á–Ω–æ –Ω–µ –∑–∞–±–æ—Ç–∏—Ç–µ—Å—å.
///–ï—Å–ª–∏ –≤—ã –≤–º–µ—Å—Ç–æ Never —É–∫–∞–∑–∞–ª–∏ –±—ã —Ä–µ–∞–ª—å–Ω—ã–π —Ç–∏–ø –æ—à–∏–±–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä: AnyPublisher<String, AuthError>
///—Ç–æ–≥–¥–∞ –≤ .sink –ø—Ä–∏–¥—ë—Ç—Å—è –ø–∏—Å–∞—Ç—å:
///.sink(   receiveCompletion: { completion in     switch completion { case .failure(let err): // —Å—é–¥–∞ –ø—Ä–∏–¥—ë—Ç AuthError case .finished: // —Å—é–¥–∞ –ø—Ä–∏–¥—ë—Ç, –∫–æ–≥–¥–∞ –ø–æ—Ç–æ–∫ –∑–∞–∫—Ä—ã—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ }},receiveValue: { userId in // —Å—é–¥–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç String-–∑–Ω–∞—á–µ–Ω–∏—è }}
///–ü–æ—á–µ–º—É –∏–Ω–æ–≥–¥–∞ —É–¥–æ–±–Ω–æ Failure == Never + Result<‚Ä¶,Error>:
///‚Äì –≤—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ ¬´—Ä–µ–∂–µ—Ç–µ¬ª —Ü–µ–ø–æ—á–∫—É Combine-–æ—à–∏–±–∫–æ–π, –∞ –≤—Å–µ–≥–¥–∞ —Å–∞–º–∏ —Ä–µ—à–∞–µ—Ç–µ, —É–ø–∞–ª–∞ –ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è, –≤–Ω—É—Ç—Ä–∏ Result. ‚Äì –ø–æ—Ç–æ–∫–∏ –º–æ–∂–Ω–æ —Å–º–µ—à–∏–≤–∞—Ç—å (merge, combineLatest) –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫. ‚Äì UI-–∫–æ–¥ –ø–æ–¥–ø–∏—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ—â–µ: –æ–¥–Ω–∞ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –∏—Å—Ö–æ–¥–æ–≤ (—É—Å–ø–µ—Ö –∏–ª–∏ –±–∏–∑–Ω–µ—Å-–æ—à–∏–±–∫–∞).
//–ö–æ—Ä–æ—Ç–∫–æ:
///–ü–∞—Ä–∞–º–µ—Ç—Ä <‚Ä¶ , Never> –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å–∞–º Combine-–ø–æ—Ç–æ–∫ –Ω–µ –≤—ã–¥–∞—Å—Ç –æ—à–∏–±–æ–∫, –æ–Ω —Ç–æ–ª—å–∫–æ –≤—ã–¥–∞—ë—Ç –∑–Ω–∞—á–µ–Ω–∏—è Result<‚Ä¶,Error>, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã —Å–∞–º–∏ –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç–µ –ª—é–±—É—é –±–∏–∑–Ω–µ—Å-–æ—à–∏–±–∫—É.
///–ï—Å–ª–∏ –±—ã –≤—ã —Ö–æ—Ç–µ–ª–∏, —á—Ç–æ–±—ã Combine –ø—Ä–µ—Ä—ã–≤–∞–ª —Ü–µ–ø–æ—á–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ, –≤—ã –±—ã –∑–∞–º–µ–Ω–∏–ª–∏ Never –Ω–∞ —Å–≤–æ–π —Ç–∏–ø (–Ω–∞–ø—Ä–∏–º–µ—Ä AuthError) –∏ –ø—É—à–∏–ª–∏ –±—ã .failure(AuthError) —á–µ—Ä–µ–∑ Fail –∏–ª–∏ Future/promise(.failure). - –¢–û–ì–î–ê –ë–´ –ü–û–¢–û–ö –°–†–ê–ó–£ –ñ–ï –ü–ï–†–ï–®–û–õ –ù–ê .SINK –ú–ò–ù–£–Ø .flatMap




// MARK: - ¬´–ø–∞–π–ø–ª–∞–π–Ω¬ª ‚Äî —ç—Ç–æ

///–í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ Combine (–∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–æ–±—â–µ) ¬´–ø–∞–π–ø–ª–∞–π–Ω¬ª ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ü–µ–ø–æ—á–∫–∞ —à–∞–≥–æ–≤ (–æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤), —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∫ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—é. –ü—Ä–µ–¥—Å—Ç–∞–≤—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä, –≥–¥–µ –∫–∞–∂–¥–∞—è —Å—Ç–∞–Ω—Ü–∏—è —á—Ç–æ-—Ç–æ –∫ –¥–µ—Ç–∞–ª–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–ª–∏ –º–µ–Ω—è–µ—Ç, –∞ –ø–æ—Ç–æ–º –ø–µ—Ä–µ–¥–∞—ë—Ç –¥–∞–ª—å—à–µ.
/// 1. –ò—Å—Ç–æ—á–Ω–∏–∫ (Publisher) –°–æ–∑–¥–∞—ë—Ç —Å–æ–±—ã—Ç–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏—Ö–æ–¥–∏—Ç User –∏–ª–∏ Void).
/// 2. –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –ö–∞–∂–¥—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä (map, flatMap, filter, handleEvents –∏ —Ç. –¥.) ‚Äì –ø–æ–ª—É—á–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã, ‚Äì —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∏—Ö –∏–ª–∏ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –Ω–∏—Ö, ‚Äì —ç–º–∏—Ç–∏—Ç –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç (–∏–ª–∏ –æ—à–∏–±–∫—É), –∫–æ—Ç–æ—Ä—ã–π —É—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –æ–ø–µ—Ä–∞—Ç–æ—Ä—É.
/// 3. –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å (Subscriber) –í –∫–æ–Ω—Ü–µ —Ü–µ–ø–æ—á–∫–∏ –≤—ã –æ–±—ã—á–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç–µ .sink –∏–ª–∏ assign, —á—Ç–æ–±—ã –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã: ‚Äì .receiveValue ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ —É—Å–ø–µ—Ö, ‚Äì .receiveCompletion ‚Äî –ª–æ–≤–∏—Ç–µ .finished –∏–ª–∏ .failure.



// MARK: - Data stream –≤ Combine


/// Data stream –≤ Combine ‚Äî —ç—Ç–æ –ø–æ—Ç–æ–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π –¥–≤–∏–∂–µ—Ç—Å—è –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (Publisher) —á–µ—Ä–µ–∑ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã (Operators) –∫ –ø–æ–¥–ø–∏—Å—á–∏–∫—É (Subscriber). –¢–∞–∫–æ–π –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å: –æ–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π (.value) , –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –±–µ–∑ –æ—à–∏–±–∫–∏ (.finished) , –ª–∏–±–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å –æ—à–∏–±–∫–æ–π (.failure).
