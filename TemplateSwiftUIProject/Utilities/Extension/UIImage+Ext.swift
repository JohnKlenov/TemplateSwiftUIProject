//
//  UIImage+Ext.swift
//  TemplateSwiftUIProject
//
//  Created by Evgenyi on 19.09.25.
//


import UIKit

extension UIImage {
    /// ÐœÐ°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€ÑƒÐµÑ‚ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ, ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑ Ð¿Ñ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¸, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ð½Ð¾ Ð²Ð¿Ð¸ÑÐ°Ð»Ð¾ÑÑŒ Ð² ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚ Ð·Ð°Ð´Ð°Ð½Ð½Ð¾Ð³Ð¾ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð°.
    ///
    /// ÐœÐµÑ‚Ð¾Ð´ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ð¾Ð´Ð±Ð¸Ñ€Ð°ÐµÑ‚ Ñ€Ð°Ð·Ð¼ÐµÑ€, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð½Ðµ Ð¸ÑÐºÐ°Ð¶Ð°Ð»Ð¾ÑÑŒ Ð¸ Ð²Ð¿Ð¸ÑÑ‹Ð²Ð°Ð»Ð¾ÑÑŒ Ð² ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚ ÑÐ¾ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð¾Ð¹ `maxSide`.
    /// ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÐµÑÐ»Ð¸ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð³Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ, Ð¾Ð½Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¾ Ð¿Ð¾ ÑˆÐ¸Ñ€Ð¸Ð½Ðµ, Ð° Ð²Ñ‹ÑÐ¾Ñ‚Ð° Ñ€Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ð½Ð° Ð¿Ñ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾.
    /// Ð•ÑÐ»Ð¸ Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾Ðµ â€” Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¾ Ð¿Ð¾ Ð²Ñ‹ÑÐ¾Ñ‚Ðµ, Ð° ÑˆÐ¸Ñ€Ð¸Ð½Ð° Ð¿Ð¾Ð´ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑÑ.
    ///
    /// Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ `UIGraphicsImageRenderer`, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ Ñ€ÐµÐ½Ð´ÐµÑ€Ð¸Ñ‚ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ñ ÑƒÑ‡Ñ‘Ñ‚Ð¾Ð¼ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð° ÑÐºÑ€Ð°Ð½Ð° (`scale`)
    /// Ð¸ Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð¾ÑÑ‚Ð¸ (`opaque = false`), Ñ‡Ñ‚Ð¾ Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ Ð²Ð°Ð¶Ð½Ð¾ Ð´Ð»Ñ Ð°Ð²Ð°Ñ‚Ð°Ñ€Ð¾Ð² Ð¸ Ð¿Ñ€ÐµÐ²ÑŒÑŽ.
    ///
    /// ðŸ” Ð—Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ Ð¾ÑˆÐ¸Ð±Ð¾Ðº:
    /// - ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ÑÑ, Ñ‡Ñ‚Ð¾ `maxSide > 0` â€” Ð¸Ð½Ð°Ñ‡Ðµ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ Ð¾Ñ€Ð¸Ð³Ð¸Ð½Ð°Ð».
    /// - ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ÑÑ, Ñ‡Ñ‚Ð¾ `self.size` Ð½Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð½ÑƒÐ»ÐµÐ²Ñ‹Ñ… Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹ â€” Ð¸Ð½Ð°Ñ‡Ðµ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ Ð¾Ñ€Ð¸Ð³Ð¸Ð½Ð°Ð».
    /// - ÐœÐµÑ‚Ð¾Ð´ ÑƒÑÑ‚Ð¾Ð¹Ñ‡Ð¸Ð² Ðº Ð¿Ð¾Ð²Ñ€ÐµÐ¶Ð´Ñ‘Ð½Ð½Ñ‹Ð¼ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸ÑÐ¼ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð±ÐµÐ· `CGImage`) â€” Ð² Ñ…ÑƒÐ´ÑˆÐµÐ¼ ÑÐ»ÑƒÑ‡Ð°Ðµ Ð²ÐµÑ€Ð½Ñ‘Ñ‚ Ð¿ÑƒÑÑ‚Ð¾Ðµ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ.
    /// - ÐŸÑ€Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ñ… Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ `autoreleasepool {}` Ð²Ð½Ðµ Ð¼ÐµÑ‚Ð¾Ð´Ð°, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸Ð·Ð±ÐµÐ¶Ð°Ñ‚ÑŒ ÑƒÑ‚ÐµÑ‡ÐµÐº Ð¿Ð°Ð¼ÑÑ‚Ð¸.
    ///
    /// - Parameter maxSide: ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ Ð´Ð»Ð¸Ð½Ð° ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹ ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚Ð° (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 300 Ð´Ð»Ñ 300x300).
    /// - Returns: ÐÐ¾Ð²Ð¾Ðµ `UIImage`, Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²Ð°Ð½Ð½Ð¾Ðµ Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸ÐµÐ¼ Ð¿Ñ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¹ Ð¸Ð»Ð¸ Ð¾Ñ€Ð¸Ð³Ð¸Ð½Ð°Ð», ÐµÑÐ»Ð¸ Ð²Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð½ÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹.
    func resizedMaintainingAspectRatio(toFit maxSide: CGFloat) -> UIImage? {
        guard maxSide > 0 else { return nil }
        guard self.size.width > 0, self.size.height > 0 else { return nil }
        
        ///max Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð±Ð¾Ð»ÑŒÑˆÐµÐµ Ð¸Ð· Ð´Ð²ÑƒÑ… Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹
        let maxOriginalSide = max(self.size.width, self.size.height)
            guard maxOriginalSide > maxSide else {
                // Ð˜Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ ÑƒÐ¶Ðµ Ð¼ÐµÐ½ÑŒÑˆÐµ â€” Ð½Ðµ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÐµÐ¼
                return self
            }
        
        let originalSize = self.size
        let aspectRatio = originalSize.width / originalSize.height

        var targetSize: CGSize
        if aspectRatio > 1 {
            // Ð“Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ: Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ð²Ð°ÐµÐ¼ ÑˆÐ¸Ñ€Ð¸Ð½Ñƒ
            targetSize = CGSize(width: maxSide, height: maxSide / aspectRatio)
        } else {
            // Ð’ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¸Ð»Ð¸ ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚Ð½Ð¾Ðµ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ: Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ð²Ð°ÐµÐ¼ Ð²Ñ‹ÑÐ¾Ñ‚Ñƒ
            targetSize = CGSize(width: maxSide * aspectRatio, height: maxSide)
        }

        let format = UIGraphicsImageRendererFormat.default()
        format.scale = self.scale // ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ‡Ñ‘Ñ‚ÐºÐ¾ÑÑ‚ÑŒ Ð½Ð° Retina
        format.opaque = false     // Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÐ¼ Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð¾ÑÑ‚ÑŒ

        let renderer = UIGraphicsImageRenderer(size: targetSize, format: format)
        return renderer.image { _ in
            self.draw(in: CGRect(origin: .zero, size: targetSize))
        }
    }
}

//import UIKit
//
//extension UIImage {
//    /// ÐœÐ°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€ÑƒÐµÑ‚ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ, ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑ Ð¿Ñ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¸, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ð½Ð¾ Ð²Ð¿Ð¸ÑÐ°Ð»Ð¾ÑÑŒ Ð² ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚ Ð·Ð°Ð´Ð°Ð½Ð½Ð¾Ð³Ð¾ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð°.
//    ///
//    /// ÐœÐµÑ‚Ð¾Ð´ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ð¾Ð´Ð±Ð¸Ñ€Ð°ÐµÑ‚ Ñ€Ð°Ð·Ð¼ÐµÑ€, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð½Ðµ Ð¸ÑÐºÐ°Ð¶Ð°Ð»Ð¾ÑÑŒ Ð¸ Ð²Ð¿Ð¸ÑÑ‹Ð²Ð°Ð»Ð¾ÑÑŒ Ð² ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚ ÑÐ¾ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð¾Ð¹ `maxSide`.
//    /// ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÐµÑÐ»Ð¸ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð³Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ, Ð¾Ð½Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¾ Ð¿Ð¾ ÑˆÐ¸Ñ€Ð¸Ð½Ðµ, Ð° Ð²Ñ‹ÑÐ¾Ñ‚Ð° Ñ€Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ð½Ð° Ð¿Ñ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾.
//    /// Ð•ÑÐ»Ð¸ Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾Ðµ â€” Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¾ Ð¿Ð¾ Ð²Ñ‹ÑÐ¾Ñ‚Ðµ, Ð° ÑˆÐ¸Ñ€Ð¸Ð½Ð° Ð¿Ð¾Ð´ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑÑ.
//    ///
//    /// Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ `UIGraphicsImageRenderer`, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ Ñ€ÐµÐ½Ð´ÐµÑ€Ð¸Ñ‚ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ñ ÑƒÑ‡Ñ‘Ñ‚Ð¾Ð¼ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð° ÑÐºÑ€Ð°Ð½Ð° (`scale`)
//    /// Ð¸ Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð¾ÑÑ‚Ð¸ (`opaque = false`), Ñ‡Ñ‚Ð¾ Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ Ð²Ð°Ð¶Ð½Ð¾ Ð´Ð»Ñ Ð°Ð²Ð°Ñ‚Ð°Ñ€Ð¾Ð² Ð¸ Ð¿Ñ€ÐµÐ²ÑŒÑŽ.
//    ///
//    / - Parameter maxSide: ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ Ð´Ð»Ð¸Ð½Ð° ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹ ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚Ð° (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 300 Ð´Ð»Ñ 300x300).
//    / - Returns: ÐÐ¾Ð²Ð¾Ðµ `UIImage`, Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²Ð°Ð½Ð½Ð¾Ðµ Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸ÐµÐ¼ Ð¿Ñ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¹.
//    /
//    func resizedMaintainingAspectRatio(toFit maxSide: CGFloat) -> UIImage {
//        guard maxSide > 0 else { return self }
//        guard self.size.width > 0, self.size.height > 0 else { return self }
//
//        let originalSize = self.size
//        let aspectRatio = originalSize.width / originalSize.height
//
//        var targetSize: CGSize
//        if aspectRatio > 1 {
//            targetSize = CGSize(width: maxSide, height: maxSide / aspectRatio)
//        } else {
//            targetSize = CGSize(width: maxSide * aspectRatio, height: maxSide)
//        }
//
//        let format = UIGraphicsImageRendererFormat.default()
//        format.scale = self.scale
//        format.opaque = false
//
//        let renderer = UIGraphicsImageRenderer(size: targetSize, format: format)
//        return renderer.image { _ in
//            self.draw(in: CGRect(origin: .zero, size: targetSize))
//        }
//    }
//}
