


// MARK: - –∫–æ–≥–¥–∞ –≤–Ω—É—Ç—Ä–∏ Cloud Function —á—Ç–æ‚Äë—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ –∏ —Ç—ã –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–ª logger.error


//–ß—Ç–æ –¥–µ–ª–∞—é—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

//1. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ + –∞–ª–µ—Ä—Ç–∏–Ω–≥

///logger.error —Å–∞–º –ø–æ —Å–µ–±–µ –ø–∏—à–µ—Ç –≤ Google Cloud Logging (Stackdriver).
///–ù–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –æ–±—ã—á–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç –∞–ª–µ—Ä—Ç—ã: –µ—Å–ª–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –º–∏–Ω—É—Ç –ø–æ—è–≤–∏–ª–æ—Å—å M –æ—à–∏–±–æ–∫ ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Slack, Teams, Email, PagerDuty. —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Google Cloud Monitoring (Alerting Policies).
///–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –∫–æ–º–∞–Ω–¥–∞ —É–∑–Ω–∞—ë—Ç –æ –ø—Ä–æ–±–ª–µ–º–µ —Å—Ä–∞–∑—É, –∞ –Ω–µ —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é.


//2. –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (retry)

///–î–ª—è background‚Äë—Ñ—É–Ω–∫—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, Pub/Sub, Firestore triggers) –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry. –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π (–±—Ä–æ—Å–∏–ª–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ), Cloud Functions —Å–∞–º –ø–æ–ø—Ä–æ–±—É–µ—Ç –µ—ë –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–Ω–æ–≤–∞. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ–µ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–µ—Ç—å, —Ç–∞–π–º–∞—É—Ç).
///–î–ª—è HTTP‚Äë—Ñ—É–Ω–∫—Ü–∏–π retry –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî –∫–ª–∏–µ–Ω—Ç —Å–∞–º –¥–æ–ª–∂–µ–Ω –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å.


//3. Dead Letter Queue (DLQ)

///–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–∞–¥–∞–µ—Ç –ø–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ—Ç—Ä–∞–µ–≤, —Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–∂–Ω–æ —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å –≤ Pub/Sub DLQ (–æ—Ç–¥–µ–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å).
///–ü–æ—Ç–æ–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—Ä—É—á–Ω—É—é –∏–ª–∏ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤–æ—Ä–∫–µ—Ä —Ä–∞–∑–±–∏—Ä–∞—é—Ç —ç—Ç–∏ ¬´–ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è¬ª.
///–≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö.


//4. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

///–í–∞–∂–Ω–æ –ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–∞–∫, —á—Ç–æ–±—ã –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ –ª–æ–º–∞–ª –¥–∞–Ω–Ω—ã–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã–∑–≤–∞–ª–æ—Å—å –¥–≤–∞–∂–¥—ã ‚Äî —ç—Ç–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–µ. –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –≤ Firestore —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Äî setData(..., merge: true) –∏–ª–∏ updateData –¥–æ–ª–∂–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç—Ä–∞–±–æ—Ç–∞—Ç—å.


//5. –û–ø–æ–≤–µ—â–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã


///–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ä–µ–¥–∫–æ —á–∏—Ç–∞—é—Ç ¬´—Å—ã—Ä—ã–µ¬ª –ª–æ–≥–∏.
///–û–±—ã—á–Ω–æ –æ—à–∏–±–∫–∏ –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è –≤ Sentry, Datadog, New Relic –∏–ª–∏ —Ö–æ—Ç—è –±—ã –≤ Slack‚Äë–∫–∞–Ω–∞–ª —Å –∞–ª–µ—Ä—Ç–∞–º–∏.
///–¢–∞–º —Å—Ä–∞–∑—É –≤–∏–¥–Ω–æ: –∫–∞–∫–æ–π —Å–µ—Ä–≤–∏—Å, –∫–∞–∫–æ–π —Å—Ç–µ–∫‚Äë—Ç—Ä–µ–π—Å, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–≤—Ç–æ—Ä–∏–ª–æ—Å—å.



//–ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ

///–§—É–Ω–∫—Ü–∏—è —É–ø–∞–ª–∞ ‚Üí logger.error ‚Üí –∑–∞–ø–∏—Å—å –≤ Cloud Logging.
///Cloud Monitoring –≤–∏–¥–∏—Ç, —á—Ç–æ –∑–∞ 5 –º–∏–Ω—É—Ç >10 –æ—à–∏–±–æ–∫ ‚Üí —à–ª—ë—Ç –∞–ª–µ—Ä—Ç –≤ Slack.
///–ï—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω retry ‚Üí —Ñ—É–Ω–∫—Ü–∏—è —Å–∞–º–∞ –ø–æ–ø—Ä–æ–±—É–µ—Ç –µ—â—ë —Ä–∞–∑.
///–ï—Å–ª–∏ –∏ –ø–æ—Å–ª–µ retry –æ—à–∏–±–∫–∞ ‚Üí —Å–æ–±—ã—Ç–∏–µ —É—Ö–æ–¥–∏—Ç –≤ DLQ.
///–ö–æ–º–∞–Ω–¥–∞ —É—Ç—Ä–æ–º –≤–∏–¥–∏—Ç –∞–ª–µ—Ä—Ç + DLQ –∏ —Ä–∞–∑–±–∏—Ä–∞–µ—Ç –∫–µ–π—Å.



// MARK: - –ó–∞–¥–∞—á–∏ –¥–ª—è Profile


// path 1


// –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–µ—Å—å —Ç–µ–∫—Å—Ç + inject AppColors

// deleteAccount —Å–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ (–ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç function (—É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö —É –ø–µ—Ä–º–∞–Ω–µ–Ω—Ç–Ω–æ–≥–æ —é–∑–µ—Ä–∞ –≤ users/${uid}) –Ω–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ Storage urlImage)






// path 2


/*
1. ProfileView –∏ –¥–æ—á–µ—Ä–Ω–∏–µ View:
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Localizable.strings).
   - [ ] –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å UI –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (Auto Layout, Dynamic Type).
   - [ ] –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞—Ç—å Color (—á–µ—Ä–µ–∑ Asset Catalog —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–π).

2. Cloud Function: —É–¥–∞–ª–µ–Ω–∏–µ avatarImage
   - [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–æ–≤ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤:
         ‚Ä¢ –î–æ–±–∞–≤–∏—Ç—å –∞–≤–∞—Ç–∞—Ä—ã –≤–æ –≤—Ç–æ—Ä–æ–π –∞–∫–∫–∞—É–Ω—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ—á–∏—Å—Ç–∫–∏.
   - [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤ "keep" –æ—Å—Ç–∞—é—Ç—Å—è N –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∞–≤–∞—Ç–∞—Ä–æ–≤ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (—Å–µ–π—á–∞—Å N = 2).
   - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —ç—Ç–∏ N –∞–≤–∞—Ç–∞—Ä–æ–≤ –Ω–∞–≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞—é—Ç—Å—è –≤ Storage.

3. Cloud Function: —É–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - [ ] –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ: —É–¥–∞–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ CloudFirestore.
   - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ Storage (–ø—É—Ç—å avatars/uid).
   - [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: —É–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ ‚Üí —Ç—Ä–∏–≥–≥–µ—Ä —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

4. Cloud Function: —É–¥–∞–ª–µ–Ω–∏–µ –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
   - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (Firestore + Storage).
   - [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —É—Å–ª–æ–≤–∏–µ —É–¥–∞–ª–µ–Ω–∏—è:
         ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–¥–µ–ª–∞–ª SignIn ‚Üí —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –∞–Ω–æ–Ω–∏–º–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç.
         ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–≥–æ –Ω–µ –∑–∞—Ö–æ–¥–∏—Ç ‚Üí —Å—á–∏—Ç–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–º –∏ —É–¥–∞–ª–∏—Ç—å.
   - [ ] –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é —É–¥–∞–ª–µ–Ω–∏—è –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
*/





// MARK:  Cloud Function: —É–¥–∞–ª–µ–Ω–∏–µ –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤

// —Å—Ü–µ–Ω–∞—Ä–∏–∏ :





//1. Anon ‚Üí SignIn (–º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∞–Ω–æ–Ω)


// !!! –ú—ã –Ω–µ –±—É–¥–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —ç—Ç–æ—Ç –∫–æ–¥ —á—Ç–æ –±—ã –Ω–µ —É—Å–ª–æ–∂–Ω—è—Ç—å –ª–æ–≥–∏–∫—É (–æ—Å—Ç–∞–≤–∏–º —Ç–æ–ª—å–∫–æ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ç—É—Ö—à–∏—Ö –∞–Ω–æ–Ω –∞–∫–∫–∞—É–Ω—Ç–æ–≤)

///–í–æ—Ç —Ç—É—Ç –∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è ¬´—Å–∏—Ä–æ—Ç–∞¬ª: —Ç–µ–∫—É—â–∏–π –∞–Ω–æ–Ω–∏–º–Ω—ã–π uid –æ—Å—Ç–∞—ë—Ç—Å—è –≤ Firebase, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–æ–ª—å—à–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–º–æ–∂–µ—Ç –∏–º –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è. –ò–º–µ–Ω–Ω–æ –µ–≥–æ –∏ –Ω—É–∂–Ω–æ —É–¥–∞–ª—è—Ç—å.
///–ö–ª–∏–µ–Ω—Ç (Swift, iOS) ‚Äì –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ signIn –º—ã –±–µ—Ä—ë–º anonUid (—Å—Ç–∞—Ä—ã–π –∞–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–≥–æ –≤ Cloud Function.
/// if let currentUser = Auth.auth().currentUser, currentUser.isAnonymous { anonUid = currentUser.uid }
/// Cloud Function (Node.js, Firebase Admin SDK) ‚Äì –ø—Ä–∏–Ω–∏–º–∞–µ—Ç uid, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ —ç—Ç–æ –∞–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∏ —É–¥–∞–ª—è–µ—Ç –µ–≥–æ. –≠—Ç–æ –≤—ã–∑–æ–≤–µ—Ç —Ç–≤–æ–π onDelete‚Äë—Ç—Ä–∏–≥–≥–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —á–∏—Å—Ç–∏—Ç Firestore –∏ Storage.






//2. –ê–Ω–æ–Ω–∏–º–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–æ–ª–≥–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (—É–¥–∞–ª–µ–Ω–∏–µ –∞–Ω–æ–Ω –ø–æ —Ç—Ä–µ–∫–∫–µ—Ä—É/—Ç–∞–π–º–µ—Ä—É)

///Firebase –Ω–µ —É–¥–∞–ª—è–µ—Ç –∞–Ω–æ–Ω–∏–º–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
///–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –≤ Firestore –º–µ—Ç–∫—É createdAt –∏ –æ–±–Ω–æ–≤–ª—è—é—Ç lastActiveAt –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
///–ó–∞–ø—É—Å–∫–∞—é—Ç scheduled Cloud Function (cron, –Ω–∞–ø—Ä–∏–º–µ—Ä —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏).
///–§—É–Ω–∫—Ü–∏—è –∏—â–µ—Ç –∞–Ω–æ–Ω–∏–º–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö lastActiveAt < now - 30d (–∏–ª–∏ 90d, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–ª–∏—Ç–∏–∫–∏).
///–î–ª—è —Ç–∞–∫–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è admin.auth().deleteUser(uid).
///–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç onDelete ‚Üí –æ—á–∏—Å—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ Firestore –∏ Storage.


// !!!! cleanupAnonTracker —É–¥–∞–ª–µ–Ω (–≤ –Ω–∞—à–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–¥–∞–ª—è–µ–º anonAccountTracker)
// –º—ã –∫–æ–≥–¥–∞ –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –≤—ã–±–æ—Ä–∫—É –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –º–µ–Ω—è–º –ø–æ–ª–µ anonUser –Ω–∞ true




// —Ç–µ—Å—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

// –¢–µ—Å—Ç5 –ü—Ä–æ–≤–µ—Ä–∫–∞ deleteUserData (—É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö profile + storage): SignUp klenovDeleteUserData (Profile + Avatars + card) -> DeleteAccount








// –µ—Å–ª–∏ —ç—Ç–∏ —Ç–µ—Å—Ç—ã –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–∏ —É–¥–∞–ª—è–µ–º cleanupInactiveAnonUsersTest.js + —Å–æ–∑–¥–∞–µ–º –¥–≤–∞ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∞ cleanupInactiveAnonUsers.js
// –¥–≤–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–∞ –º–æ—é –ø–æ—á—Ç—É –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ —Ä–∞–±–æ—Ç—É cleanupUnusedAvatars.js + —É–¥–∞–ª—è–µ–º –∏—Ö –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É deleteUserData.js

//ProfileView –∏ –¥–æ—á–µ—Ä–Ω–∏–µ View 









//–ß—Ç–æ —Ç–∞–∫–æ–µ Timestamp(date: Date()) ?

///–í iOS SDK –¥–ª—è Firestore –µ—Å—Ç—å —Ç–∏–ø Timestamp (FirebaseFirestore.Timestamp).
///–≠—Ç–æ –æ–±—ë—Ä—Ç–∫–∞ –≤–æ–∫—Ä—É–≥ –¥–∞—Ç—ã/–≤—Ä–µ–º–µ–Ω–∏, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ¬´—Å–µ–∫—É–Ω–¥—ã + –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥—ã —Å –Ω–∞—á–∞–ª–∞ —ç–ø–æ—Ö–∏ (Unix time)¬ª.
///–ö–æ–≥–¥–∞ —Ç—ã –ø–∏—à–µ—à—å Timestamp(date: Date()), —Ç—ã –±–µ—Ä—ë—à—å —Ç–µ–∫—É—â—É—é Date –∏–∑ Swift –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—à—å –µ—ë –≤ Firestore‚Äë—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π Timestamp.
///Firestore –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö timestamp. –¢–æ –µ—Å—Ç—å —ç—Ç–æ –Ω–µ —Å—Ç—Ä–æ–∫–∞ –∏ –Ω–µ —á–∏—Å–ª–æ, –∞ –∏–º–µ–Ω–Ω–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–∏–ø, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö (where("lastActiveAt", "<", cutoff)), —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å.
///–í Firestore Console –¥–æ–∫—É–º–µ–Ω—Ç users/{uid} –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:

//createdAt     September 28, 2025 at 14:35:12 UTC+3   (timestamp)
//lastActiveAt  September 28, 2025 at 14:35:12 UTC+3   (timestamp)
//isAnonymous   true                                    (boolean)




//üîπ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ç–æ—Ç –∫–æ–¥ (–ø–æ —à–∞–≥–∞–º)
//–†–∞–∑ –≤ —Å—É—Ç–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è (–æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∏ —Ç–µ—Å—Ç–∞).
//–í—ã—á–∏—Å–ª—è–µ—Ç—Å—è –¥–µ–¥–ª–∞–π–Ω:
//30 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ (–ø—Ä–æ–¥–∞–∫—à–µ–Ω)
//1 –¥–µ–Ω—å –Ω–∞–∑–∞–¥ (—Ç–µ—Å—Ç)
//–ó–∞–ø—Ä–æ—Å –∫ Firestore: –∏—â–µ–º –≤—Å–µ anonAccountTracker, –≥–¥–µ isAnonymous == true –∏ lastActiveAt < cutoff.
//–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞:
//–ü–æ–ª—É—á–∞–µ–º UserRecord –∏–∑ Firebase Auth.
//–ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (providerData.length > 0) ‚Üí –∑–Ω–∞—á–∏—Ç, –æ–Ω —É–∂–µ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ–º.
//–ï—Å–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –Ω–µ—Ç ‚Üí —ç—Ç–æ –≤—Å—ë –µ—â—ë –∞–Ω–æ–Ω–∏–º–Ω—ã–π ‚Üí —É–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ admin.auth().deleteUser(uid).
//–£ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä (email, Google, Apple –∏ —Ç. –¥.).
//–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –Ω–µ—Ç –≤ Auth ‚Üí –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º, –∞ —Ç—Ä–µ–∫–µ—Ä –ø–æ–¥—á–∏—Å—Ç–∏—Ç onDelete.
//–£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–µ—Ä–æ–≤ –≤—Ä—É—á–Ω—É—é –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è ‚Äî —ç—Ç–∏–º –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è functions.auth.user().onDelete.














// –ù–∞ cartProduct –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–Ω–æ–Ω–∏–º–Ω—ã–π —Ç–æ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ –º—ã —Å–º–æ–∂–µ–º –≤–∏–¥–∏—Ç—å –∫–Ω–æ–ø–∫—É Create Account –ø–µ—Ä–µ–π–¥—è –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –º—ã –ø–æ–ø–∞–¥–∞–µ–º –Ω–∞ —Å—Ç–µ–∫ SignIn + SignUp (–∏–ª–∏ SignUp + SignIn)







// old index.js

///**
// * Firebase Cloud Functions ‚Äî TemplateSwiftUIProject
// * –†–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ –æ—á–∏—â–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
// */
//
//const functions = require('firebase-functions/v1');
//const admin = require('firebase-admin');
//const { setGlobalOptions, logger } = require('firebase-functions');
//
//setGlobalOptions({ maxInstances: 10 });
//admin.initializeApp();
//
//exports.deleteUserData = functions.auth.user().onDelete(async (user) => {
//  const uid = user.uid;
//  const userRef = admin.firestore().doc(`users/${uid}`);
//
//  try {
//    // 1. –£–¥–∞–ª—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firestore (–≤–∫–ª—é—á–∞—è –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏)
//    await admin.firestore().recursiveDelete(userRef);
//    logger.info(`‚úÖ –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ Firestore-–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${uid}`, { uid });
//
//    // 2. –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Storage –ø–æ –ø—É—Ç–∏ avatars/${uid}/
//    const bucket = admin.storage().bucket();
//    const [files] = await bucket.getFiles({ prefix: `avatars/${uid}/` });
//
//    if (files.length > 0) {
//      await Promise.all(files.map((file) => file.delete()));
//      logger.info(`‚úÖ –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Ñ–∞–π–ª—ã –≤ Storage –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${uid}`, { uid });
//    } else {
//      logger.info(`‚ÑπÔ∏è –ù–µ—Ç —Ñ–∞–π–ª–æ–≤ –≤ Storage –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${uid}`, { uid });
//    }
//  } catch (error) {
//    logger.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${uid}`, {
//      uid,
//      error,
//    });
//  }
//});
//
//exports.cleanupUnusedAvatars =
//  require('./cleanupUnusedAvatars').cleanupUnusedAvatars;
//
//exports.cleanupInactiveAnonUsersTest =
// require('./cleanupInactiveAnonUsersTest').cleanupInactiveAnonUsersTest;
//
//exports.cleanupInactiveAnonUsers =
// require('./cleanupInactiveAnonUsers').cleanupInactiveAnonUsers;
